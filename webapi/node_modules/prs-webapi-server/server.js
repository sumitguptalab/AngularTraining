const express = require("express");
var app = express();

const cors = require("cors");
app.use(cors());
app.options("*", cors());

var bodyParser = require("body-parser");
app.use(bodyParser.urlencoded({ extended: false }));

var multer = require("multer");
var upload = multer();

var UsersCtrl = require("./users.controller.js");
var usersCtrl = new UsersCtrl();

app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));

app.get("/Users/List", (req, res) => {
  res.send(usersCtrl.list());
});

app.get("/Users/Get/:id", (req, res) => {
  var id = +req.params.id;
  console.log('server : = ' + id )
  console.log('-------------------------------------------------');
  res.send(usersCtrl.get(id));
});

app.post("/Users/Create", upload.array(), (req, res, next) => {
  res.send(usersCtrl.create(req.body));
});

app.post("/Users/Change", upload.array(), (req, res, next) => {
  res.send(usersCtrl.change(req.body));
});

app.post("/Users/Remove", upload.array(), (req, res, next) => {
  res.send(usersCtrl.remove(req.body));
});

app.get("/Authencate/:userName/:password", (req, res) => {
  var username = req.params.userName;
  var pwd = req.params.password;
  console.log('server : = ' + username + '|' + pwd )
  console.log('-------------------------------------------------');
  res.send(usersCtrl.Authencate(username, pwd));
});

var server = app.listen(5000, () => {
  console.log("Node server running on 5000 ...");
});